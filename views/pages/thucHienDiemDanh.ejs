<!-- Content -->
<section class="flex-1 overflow-auto p-4">
    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-4">
        <nav class="flex space-x-4 text-sm font-semibold select-none">
            <a href="?tab=morning"
                class="<% if(activeTab !== 'afternoon') { %>border-b-2 border-[#3ad597] text-[#3ad597]<% } else { %>text-gray-400<% } %> pb-2">
                Điểm danh buổi sáng
            </a>
            <a href="?tab=afternoon"
                class="<% if(activeTab === 'afternoon') { %>border-b-2 border-[#3ad597] text-[#3ad597]<% } else { %>text-gray-400<% } %> pb-2">
                Điểm danh buổi chiều
            </a>
        </nav>
    </div>
    <!-- Filters and buttons -->
    <div class="flex flex-wrap items-center gap-2 border border-[#3ad597] rounded px-3 py-1 mb-4 select-none max-w-full"
        style="max-width: 570px;">

        <select name="lop_hoc_id" class="border border-gray-300 rounded px-2 py-1 text-sm">
            <% danhSachLopHoc.forEach(lop=> { %>
                <option value="<%= lop.lop_hoc_id %>">
                    <%= lop.ten_lop %>
                </option>
                <% }) %>
        </select>

        <button aria-label="Previous day" class="text-[#3ad597] hover:bg-[#d6f5e8] rounded px-2 py-1">
            <i class="fas fa-chevron-left">
            </i>
        </button>
        <span class="text-sm text-[#475569] font-normal select-text">
            Thứ 6, ngày 22/7/2022
        </span>
        <button aria-label="Next day" class="text-[#3ad597] hover:bg-[#d6f5e8] rounded px-2 py-1">
            <i class="fas fa-chevron-right">
            </i>
        </button>
        <button aria-label="Open calendar" class="text-[#3ad597] hover:bg-[#d6f5e8] rounded px-2 py-1">
            <i class="fas fa-calendar-alt">
            </i>
        </button>
    </div>

    <!-- SỈ SÓ -->
    <div class="flex flex-wrap gap-2 mb-4 max-w-full">
        <button class="border border-[#3ad597] text-[#3ad597] rounded px-3 py-1 text-xs font-semibold select-none">
            Sỉ số: <%= tongLopHoc[0].tong %>
        </button>
        <button class="border border-gray-300 text-gray-400 rounded px-3 py-1 text-xs font-semibold select-none"
            disabled="">
            Có mặt: <%= tongCoMat[0].tong %>
        </button>
        <button class="border border-gray-300 text-gray-400 rounded px-3 py-1 text-xs font-semibold select-none"
            disabled="">
            Vắng: <%= tongVang[0].tong %>
        </button>
        <div style="margin-left: 30cm;">
            <form action="/thuc-hien-diem-danh/xuat-excel" method="get">
                <button
                    class="ml-auto bg-[#0f7a3f] hover:bg-[#0b5a2a] text-white rounded px-4 py-1 text-xs font-semibold select-none">
                    Xuất file
                </button>
            </form>
        </div>
        <div style="margin-left: auto;">
            <form action="/thuc-hien-diem-danh/diem-danh-khuon-mat" method="get">
                <button
                    class="ml-auto bg-[#0f7a3f] hover:bg-[#0b5a2a] text-white rounded px-4 py-1 text-xs font-semibold select-none">
                    Điểm danh khuôn mặt
                </button>
            </form>
        </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto scrollbar-thin">
        <table class="min-w-full border border-gray-200 rounded-md text-xs text-left" id="studentTable">
            <thead class="bg-white border-b border-gray-200 text-gray-600 select-none">
                <tr>
                    <th class="w-10 px-3 py-2 border-r border-gray-200 font-semibold">
                        STT
                    </th>
                    <th class="min-w-[160px] px-3 py-2 border-r border-gray-200 font-semibold" style="width: 20cm;">
                        Họ tên
                    </th>
                    <th class="w-28 px-3 py-2 border-r border-gray-200 font-semibold">
                        Ngày sinh
                    </th>
                    <th class="w-20 px-3 py-2 border-r border-gray-200 font-semibold cursor-pointer">
                        Trạng thái
                    </th>
                    <th class="w-32 px-3 py-2 font-semibold cursor-pointer">
                        Ghi chú
                    </th>
                </tr>
                <tr class="bg-white">
                    <th>
                    </th>

                    <th class="px-3 py-1 border-r border-gray-200">
                        <input id="searchStudentInput"
                            class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-[#3ad597]"
                            placeholder="Nhập tên học sinh cần tìm" type="text" oninput="filterStudents()" />
                    </th>
                    <th class="w-28 px-3 py-2 border-r border-gray-200 font-semibold">
                    </th>
                    <th class="w-28 px-3 py-2 border-r border-gray-200 font-semibold">
                    </th>
                    <th class="w-28 px-3 py-2 border-r border-gray-200 font-semibold">
                    </th>
                </tr>
            </thead>

            <!-- HIỂN THỊ -->
            <tbody class="text-gray-600">
                <% if(danhSachHocSinh && danhSachHocSinh.length> 0){ %>
                    <% danhSachHocSinh.forEach((hocSinh, index)=> { %>
                        <tr class="bg-white border-b border-gray-100 hover:bg-[#f8fafc]">
                            <td class="px-3 py-2 border-r border-gray-200">
                                <%= index + 1 %>
                            </td>
                            <td class="px-3 py-2 border-r border-gray-200">
                                <%= hocSinh.ho_ten %>
                            </td>
                            <td class="px-3 py-2 border-r border-gray-200">
                                <%= formatDate(hocSinh.ngay_sinh) %>
                            </td>
                            <td class="px-3 py-2 border-r border-gray-200 text-center">
                                <select class="border rounded px-2 py-1 text-sm 
                                    <% if(hocSinh.trang_thai == 'Có mặt') { %> 
                                    bg-green-100 text-green-800 
                                    <% } else if(hocSinh.trang_thai == 'Vắng') { %> 
                                    bg-red-100 text-red-800 
                                    <% } else { %> 
                                    bg-gray-100 text-gray-800 
                                    <% } %>" name="trang_thai[<%= hocSinh.hoc_sinh_id %>]">
                                    <option value="" selected disabled>-- Chọn trạng thái --</option>
                                    <option value="Có mặt" <%=hocSinh.trang_thai=='Có mặt' ? 'selected' : '' %>>Có mặt
                                    </option>
                                    <option value="Vắng" <%=hocSinh.trang_thai=='Vắng' ? 'selected' : '' %>>Vắng
                                    </option>
                                </select>
                            </td>

                            <td class="px-3 py-2">
                                <input type="text" class="border rounded px-2 py-1 text-sm w-full"
                                    name="ghi_chu[<%= hocSinh.hoc_sinh_id %>]" value="<%= hocSinh.ghi_chu || '' %>"
                                    placeholder="Nhập ghi chú...">
                            </td>
                        </tr>
                        <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="6" class="px-3 py-2 border-r border-gray-200 text-center">
                                        Không có dữ liệu
                                    </td>
                                </tr>
                                <% } %>
            </tbody>
        </table>
    </div>
</section>


<!-- TÌM HỌC SINH -->
<script>
    function filterStudents() {
        const input = document.getElementById('searchStudentInput');
        const filter = input.value.toUpperCase();
        const table = document.getElementById('studentTable');
        const rows = table.getElementsByTagName('tr');

        // Bắt đầu từ 2 để bỏ qua 2 hàng tiêu đề
        for (let i = 2; i < rows.length; i++) {
            const nameCell = rows[i].getElementsByTagName('td')[1]; // Cột thứ 2 chứa tên học sinh
            if (nameCell) {
                const txtValue = nameCell.textContent || nameCell.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }
    }
</script>
<!-- FORMAT DATE -->
<% function formatDate(dateStr) { if (!dateStr) return '' ; const d=new Date(dateStr); const
    day=String(d.getDate()).padStart(2, '0' ); const month=String(d.getMonth() + 1).padStart(2, '0' ); const
    year=d.getFullYear(); return `${day}/${month}/${year}`; } %>